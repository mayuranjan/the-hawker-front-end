{"version":3,"sources":["../../../../src/app/typescripts/pro/stickyContent/stickyContentDirective.ts"],"names":[],"mappings":"AAAA,YAAC,CAAY;AAEb,OAAO,EAAE,SAAA,EAAW,UAAA,EAAY,KAAA,EAAM,MAAO,eAAA,CAAgB;AAE7D,OAAO,EAAE,aAAA,EAAc,MAAO,kBAAA,CAAmB;AAIjD;IAYE,6BAAY,EAAc;QAA1B,iBAGC;QATD,oBAAe,GAAW,CAAC,CAAC;QAmE5B,kBAAa,GAAG;YAEd,IAAI,UAAU,GAAe,KAAI,CAAC,EAAE,CAAC,aAAa,CAAC,qBAAqB,EAAE,CAAC;YAC3E,IAAI,QAAQ,GAAe,QAAQ,CAAC,IAAI,CAAC,qBAAqB,EAAE,CAAC;YACjE,IAAI,QAAQ,CAAC;YAEb,EAAE,CAAC,CAAC,KAAI,CAAC,QAAQ,CAAC,KAAK,KAAK,OAAO,CAAC,CAAC,CAAC;gBACpC,IAAI,KAAK,GAAG,QAAQ,CAAC,KAAK,GAAG,UAAU,CAAC,KAAK,GAAG,KAAI,CAAC,QAAQ,CAAC,WAAW,CAAC;gBAC1E,QAAQ,GAAG,EAAE,KAAK,EAAE,KAAK,GAAG,IAAI,EAAE,CAAC;YACrC,CAAC;YAAC,IAAI,CAAC,EAAE,CAAC,CAAC,KAAI,CAAC,QAAQ,CAAC,KAAK,KAAK,MAAM,CAAC,CAAC,CAAC;gBAC1C,IAAI,IAAI,GAAG,UAAU,CAAC,IAAI,GAAG,QAAQ,CAAC,IAAI,GAAG,KAAI,CAAC,QAAQ,CAAC,UAAU,CAAC;gBACtE,QAAQ,GAAG,EAAE,IAAI,EAAE,IAAI,GAAG,IAAI,EAAC,CAAC;YAClC,CAAC;YAAC,IAAI,CAAC,CAAC;gBAEN,QAAQ,GAAG,EAAC,KAAK,EAAE,UAAU,CAAC,KAAK,GAAG,IAAI,EAAC,CAAC;YAC9C,CAAC;YAGD,EAAE,CAAC,CAAC,KAAI,CAAC,QAAQ,CAAC,SAAS,GAAG,KAAI,CAAC,QAAQ,CAAC,YAAY;gBACtD,KAAI,CAAC,QAAQ,CAAC,kBAAkB,CAAC,MAAM,GAAG,KAAI,CAAC,eAAe,IAAI,UAAU,CAAC,MAAM,CAAC,CAAC,CAAC;gBAKtF,IAAI,eAAe,GACjB,KAAI,CAAC,QAAQ,CAAC,KAAK,KAAK,OAAO,GAAG,EAAC,KAAK,EAAE,CAAC,EAAC;oBAC5C,KAAI,CAAC,QAAQ,CAAC,KAAK,KAAK,MAAM,GAAG,EAAC,IAAI,EAAE,CAAC,EAAC,GAAG,EAAE,CAAC;gBAClD,MAAM,CAAC,MAAM,CAAC,KAAI,CAAC,EAAE,CAAC,KAAK,EAAE;oBAC3B,QAAQ,EAAE,UAAU;oBACpB,KAAK,EAAE,MAAM;oBACb,GAAG,EAAE,SAAS;oBACd,MAAM,EAAE,CAAC;iBACV,EAAE,QAAQ,EAAE,eAAe,CAAC,CAAC;YAChC,CAAC;YAAC,IAAI,CAAC,EAAE,CAAC,CAAC,UAAU,CAAC,GAAG,GAAG,CAAC,CAAC,GAAG,KAAI,CAAC,QAAQ,CAAC,SAAS,GAAG,KAAI,CAAC,eAAe,GAAG,KAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC,CAAC;gBAO1G,EAAE,CAAC,CAAC,KAAI,CAAC,QAAQ,CAAC,KAAK,KAAK,MAAM,IAAI,KAAI,CAAC,QAAQ,CAAC,KAAK,KAAK,OAAO,IAAI,CAAC,KAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;oBACxF,KAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;oBAC9C,KAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,MAAM,GAAG,KAAI,CAAC,EAAE,CAAC,YAAY,GAAG,IAAI,CAAC;oBACzD,KAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,KAAI,CAAC,QAAQ,EAAE,KAAI,CAAC,EAAE,CAAC,CAAC;gBACrD,CAAC;gBAED,MAAM,CAAC,MAAM,CAAC,KAAI,CAAC,EAAE,CAAC,KAAK,EAAE;oBAC3B,QAAQ,EAAE,OAAO;oBACjB,KAAK,EAAE,MAAM;oBACb,GAAG,EAAE,KAAI,CAAC,eAAe,GAAG,IAAI;oBAChC,MAAM,EAAE,SAAS;iBAClB,EAAE,QAAQ,CAAC,CAAC;YACf,CAAC;YAAC,IAAI,CAAC,CAAC;gBAKN,EAAE,CAAC,CAAC,KAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;oBAClB,KAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,KAAI,CAAC,QAAQ,CAAC,CAAC;oBACzC,KAAI,CAAC,QAAQ,GAAG,SAAS,CAAC;gBAC5B,CAAC;gBACD,MAAM,CAAC,MAAM,CAAC,KAAI,CAAC,EAAE,CAAC,KAAK,EAAE;oBAC3B,QAAQ,EAAE,KAAI,CAAC,QAAQ,CAAC,QAAQ;oBAChC,KAAK,EAAE,KAAI,CAAC,QAAQ,CAAC,KAAK;oBAC1B,GAAG,EAAE,KAAI,CAAC,QAAQ,CAAC,GAAG;oBACtB,MAAM,EAAE,KAAI,CAAC,QAAQ,CAAC,MAAM;oBAC5B,KAAK,EAAE,KAAI,CAAC,QAAQ,CAAC,KAAK;oBAC1B,IAAI,EAAE,KAAI,CAAC,QAAQ,CAAC,IAAI;iBACzB,EAAE,QAAQ,CAAC,CAAC;YACf,CAAC;QACH,CAAC,CAAA;QAlIC,IAAI,CAAC,EAAE,GAAG,IAAI,CAAC,EAAE,GAAG,EAAE,CAAC,aAAa,CAAC;QACrC,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,EAAE,CAAC,aAAa,CAAC;IACxC,CAAC;IAED,6CAAe,GAAf;QACE,IAAI,CAAC,EAAE,CAAC,KAAK,CAAC,SAAS,GAAG,YAAY,CAAC;QAEvC,EAAE,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC;YACrB,IAAI,gBAAgB,GAAG,QAAQ,CAAC,aAAa,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;YAChE,EAAE,CAAC,CAAC,gBAAgB,CAAC,CAAC,CAAC;gBACrB,IAAI,CAAC,eAAe,GAAG,gBAAgB,CAAC,qBAAqB,EAAE,CAAC,MAAM,CAAC;YACzE,CAAC;QACH,CAAC;QAGD,IAAI,gBAAgB,GAAG,CAAC,UAAU,EAAE,OAAO,EAAE,UAAU,CAAC,CAAC;QACzD,IAAI,gBAAgB,GAAG,aAAa,CAAC,IAAI,CAAC,QAAQ,EAAE,UAAU,CAAC,CAAC;QAChE,EAAE,CAAC,CAAC,gBAAgB,CAAC,OAAO,CAAC,gBAAgB,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;YACtD,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,QAAQ,GAAG,UAAU,CAAC;QAC5C,CAAC;QAED,IAAI,CAAC,IAAI,GAAG;YACV,GAAG,EAAE,IAAI,CAAC,EAAE,CAAC,SAAS,GAAG,IAAI,CAAC,QAAQ,CAAC,SAAS;YAChD,IAAI,EAAE,IAAI,CAAC,EAAE,CAAC,UAAU,GAAG,IAAI,CAAC,QAAQ,CAAC,UAAU;SACpD,CAAC;QAEF,IAAI,MAAM,GAAG,IAAI,CAAC,EAAE,CAAC,qBAAqB,EAAE,CAAC;QAC7C,IAAI,CAAC,QAAQ,GAAG;YACd,kBAAkB,EAAE,MAAM;YAC1B,QAAQ,EAAE,aAAa,CAAC,IAAI,CAAC,EAAE,EAAE,UAAU,CAAC;YAC5C,KAAK,EAAE,aAAa,CAAC,IAAI,CAAC,EAAE,EAAE,OAAO,CAAC;YACtC,GAAG,EAAG,aAAa,CAAC,IAAI,CAAC,EAAE,EAAE,KAAK,CAAC;YACnC,MAAM,EAAG,aAAa,CAAC,IAAI,CAAC,EAAE,EAAE,QAAQ,CAAC;YACzC,IAAI,EAAE,aAAa,CAAC,IAAI,CAAC,EAAE,EAAE,MAAM,CAAC;YACpC,KAAK,EAAE,aAAa,CAAC,IAAI,CAAC,EAAE,EAAE,OAAO,CAAC;YACtC,SAAS,EAAE,IAAI,CAAC,EAAE,CAAC,SAAS;YAC5B,UAAU,EAAE,IAAI,CAAC,EAAE,CAAC,UAAU;YAC9B,SAAS,EAAE,QAAQ,CAAC,aAAa,CAAC,IAAI,CAAC,EAAE,EAAE,WAAW,CAAC,CAAC;YACxD,YAAY,EAAE,QAAQ,CAAC,aAAa,CAAC,IAAI,CAAC,EAAE,EAAE,cAAc,CAAC,CAAC;YAC9D,UAAU,EAAE,QAAQ,CAAC,aAAa,CAAC,IAAI,CAAC,EAAE,EAAE,YAAY,CAAC,CAAC;YAC1D,WAAW,EAAE,QAAQ,CAAC,aAAa,CAAC,IAAI,CAAC,EAAE,EAAE,YAAY,CAAC,CAAC;SAC5D,CAAC;QAEF,IAAI,CAAC,MAAM,EAAE,CAAC;IAChB,CAAC;IAED,yCAAW,GAAX;QACE,IAAI,CAAC,MAAM,EAAE,CAAC;IAChB,CAAC;IAED,oCAAM,GAAN;QACE,MAAM,CAAC,gBAAgB,CAAC,QAAQ,EAAE,IAAI,CAAC,aAAa,CAAC,CAAC;QACtD,MAAM,CAAC,gBAAgB,CAAC,QAAQ,EAAE,IAAI,CAAC,aAAa,CAAC,CAAC;IACxD,CAAC;IAED,oCAAM,GAAN;QACE,MAAM,CAAC,mBAAmB,CAAC,QAAQ,EAAE,IAAI,CAAC,aAAa,CAAC,CAAC;QACzD,MAAM,CAAC,mBAAmB,CAAC,QAAQ,EAAE,IAAI,CAAC,aAAa,CAAC,CAAC;IAC3D,CAAC;IAqFH,0BAAC;AAAD,CA5JA,AA4JC;;AAZM,8BAAU,GAA0B;IAC3C,EAAE,IAAI,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC;gBACxB,QAAQ,EAAE,eAAe;aAC1B,EAAG,EAAE;CACL,CAAC;AAEK,kCAAc,GAAmE,cAAM,OAAA;IAC9F,EAAC,IAAI,EAAE,UAAU,GAAG;CACnB,EAF6F,CAE7F,CAAC;AACK,kCAAc,GAA2C;IAChE,aAAa,EAAE,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC,cAAc,EAAG,EAAE,EAAE;CAC1D,CAAC","file":"stickyContentDirective.js","sourceRoot":"","sourcesContent":["'use strict';\r\n\r\nimport { Directive, ElementRef, Input } from '@angular/core';\r\n\r\nimport { computedStyle } from './computed-style';\r\n\r\n\r\n\r\nexport class NguiStickyDirective {\r\n   stickyAfter: string;  // css selector to be sticky after\r\n\r\n  el: HTMLElement;\r\n  parentEl: HTMLElement;\r\n  fillerEl: HTMLElement;\r\n  stickyOffsetTop: number = 0;\r\n\r\n\r\n  diff: any;\r\n  original: any;\r\n\r\n  constructor(el: ElementRef) {\r\n    this.el = this.el = el.nativeElement;\r\n    this.parentEl = this.el.parentElement;\r\n  }\r\n\r\n  ngAfterViewInit(): void {\r\n    this.el.style.boxSizing = 'border-box';\r\n    \r\n    if (this.stickyAfter) {\r\n      let cetStickyAfterEl = document.querySelector(this.stickyAfter);\r\n      if (cetStickyAfterEl) {\r\n        this.stickyOffsetTop = cetStickyAfterEl.getBoundingClientRect().bottom;\r\n      }\r\n    }\r\n\r\n    // set the parent relatively positioned\r\n    let allowedPositions = ['absolute', 'fixed', 'relative'];\r\n    let parentElPosition = computedStyle(this.parentEl, 'position');\r\n    if (allowedPositions.indexOf(parentElPosition) === -1) { //inherit, initial, unset\r\n      this.parentEl.style.position = 'relative';\r\n    }\r\n\r\n    this.diff = {\r\n      top: this.el.offsetTop - this.parentEl.offsetTop,\r\n      left: this.el.offsetLeft - this.parentEl.offsetLeft\r\n    };\r\n\r\n    let elRect = this.el.getBoundingClientRect();\r\n    this.original = {\r\n      boundingClientRect: elRect,\r\n      position: computedStyle(this.el, 'position'),\r\n      float: computedStyle(this.el, 'float'),\r\n      top:  computedStyle(this.el, 'top'),\r\n      bottom:  computedStyle(this.el, 'bottom'),\r\n      left: computedStyle(this.el, 'left'),\r\n      width: computedStyle(this.el, 'width'),\r\n      offsetTop: this.el.offsetTop,\r\n      offsetLeft: this.el.offsetLeft,\r\n      marginTop: parseInt(computedStyle(this.el, 'marginTop')),\r\n      marginBottom: parseInt(computedStyle(this.el, 'marginBottom')),\r\n      marginLeft: parseInt(computedStyle(this.el, 'marginLeft')),\r\n      marginRight: parseInt(computedStyle(this.el, 'marginLeft'))\r\n    };\r\n\r\n    this.attach();\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.detach();\r\n  }\r\n\r\n  attach(): void {\r\n    window.addEventListener('scroll', this.scrollHandler);\r\n    window.addEventListener('resize', this.scrollHandler);\r\n  }\r\n\r\n  detach(): void {\r\n    window.removeEventListener('scroll', this.scrollHandler);\r\n    window.removeEventListener('resize', this.scrollHandler);\r\n  }\r\n\r\n  scrollHandler = () => {\r\n    // let elRect: ClientRect = this.el.getBoundingClientRect();\r\n    let parentRect: ClientRect = this.el.parentElement.getBoundingClientRect();\r\n    let bodyRect: ClientRect = document.body.getBoundingClientRect();\r\n    let dynProps;\r\n\r\n    if (this.original.float === 'right') {\r\n      let right = bodyRect.right - parentRect.right + this.original.marginRight;\r\n      dynProps = { right: right + 'px' };\r\n    } else if (this.original.float === 'left') {\r\n      let left = parentRect.left - bodyRect.left + this.original.marginLeft;\r\n      dynProps = { left: left + 'px'};\r\n    } else {\r\n      //console.log('parentRect..............', parentRect.width);\r\n      dynProps = {width: parentRect.width + 'px'};\r\n    }\r\n    //console.log('dynProps', dynProps);\r\n\r\n    if (this.original.marginTop + this.original.marginBottom +\r\n      this.original.boundingClientRect.height + this.stickyOffsetTop >= parentRect.bottom) {\r\n      /**\r\n       * stikcy element reached to the bottom of the container\r\n       */\r\n      // console.log('case 1 (absolute)', parentRect.bottom, this.original.marginBottom);\r\n      let floatAdjustment =\r\n        this.original.float === 'right' ? {right: 0} :\r\n        this.original.float === 'left' ? {left: 0} : {};\r\n      Object.assign(this.el.style, {\r\n        position: 'absolute',\r\n        float: 'none',\r\n        top: 'inherit',\r\n        bottom: 0\r\n      }, dynProps, floatAdjustment);\r\n    } else if (parentRect.top * -1 + this.original.marginTop + this.stickyOffsetTop > this.original.offsetTop) {\r\n      /**\r\n       * stikcy element is in the middle of container\r\n       */\r\n      //console.log('case 2 (fixed)', parentRect.top * -1, this.original.marginTop, this.original.offsetTop);\r\n\r\n      // if not floating, add an empty filler element, since the original elements becames 'fixed'\r\n      if (this.original.float !== 'left' && this.original.float !== 'right' && !this.fillerEl) {\r\n        this.fillerEl = document.createElement('div');\r\n        this.fillerEl.style.height = this.el.offsetHeight + 'px';\r\n        this.parentEl.insertBefore(this.fillerEl, this.el);\r\n      }\r\n\r\n      Object.assign(this.el.style, {\r\n        position: 'fixed', //fixed is a lot smoother than absolute\r\n        float: 'none',\r\n        top: this.stickyOffsetTop + 'px',\r\n        bottom: 'inherit'\r\n      }, dynProps);\r\n    } else {\r\n      /**\r\n       * stikcy element is in the original position\r\n       */\r\n      // console.log('case 3 (original)');\r\n      if (this.fillerEl) {\r\n        this.parentEl.removeChild(this.fillerEl); //IE11 does not work with el.remove()\r\n        this.fillerEl = undefined;\r\n      }\r\n      Object.assign(this.el.style, {\r\n        position: this.original.position,\r\n        float: this.original.float,\r\n        top: this.original.top,\r\n        bottom: this.original.bottom,\r\n        width: this.original.width,\r\n        left: this.original.left\r\n      }, dynProps);\r\n    }\r\n  }\r\nstatic decorators: DecoratorInvocation[] = [\n{ type: Directive, args: [{\r\n  selector: '[ngui-sticky]'\r\n}, ] },\n];\n/** @nocollapse */\nstatic ctorParameters: () => ({type: any, decorators?: DecoratorInvocation[]}|null)[] = () => [\n{type: ElementRef, },\n];\nstatic propDecorators: {[key: string]: DecoratorInvocation[]} = {\n'stickyAfter': [{ type: Input, args: ['sticky-after', ] },],\n};\n}\r\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}